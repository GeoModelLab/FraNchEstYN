# FraNchEstYN ‚Äì Framework for syNchronous Estimates of Yield reductioN

<img src="man/figures/logo.png" alt="franchestyin logo" width="250" align="right"/>

[![License: CC BY-NC 3.0](https://img.shields.io/badge/License-CC%20BY--NC%203.0-lightgrey.svg)](https://creativecommons.org/licenses/by-nc/3.0/)
[![Platform](https://img.shields.io/badge/platform-Windows--only-blue)](https://microsoft.com)  
[![Language](https://img.shields.io/badge/language-R%20%7C%20C%23-purple)](https://cran.r-project.org/)  
![Status](https://img.shields.io/badge/status-active-brightgreen)

---

## üìñ Overview
**FraNchEstYN** is a **crop‚Äìdisease‚Äìfungicide simulation and calibration framework**, designed to support quantitative research in **plant disease epidemiology and crop modeling**.  

It integrates:  
- üå± **Crop growth & yield dynamics** (internal or external crop models)  
- ü¶† **Disease epidemiology** via weather-driven infection and damage mechanisms  
- üíä **Fungicide programs** (timing, efficacy, decay)  
- üî¨ **Calibration routines** for crop, disease, or both  
- ü§ñ *Optional*: **LLM-based narrative summaries** of results in different tones (scientist, extensionist, farmer)  

> **Note:** FraNchEstYN is released as an **R package** with **C# routines** invoked from R. It is currently available only on **Windows**, but cross-platform compatibility is under development. 

---

## üöÄ Highlights

- Coupling with **any external crop model** (via `cropModel_data`)  
- Dynamic **epidemic simulation** with yield loss quantification  
- Built-in **fungicide timing & effectiveness modeling**  
- Flexible **parameter calibration** (`"none"`, `"crop"`, `"disease"`, `"all"`)  
- AI-based **decision-support summaries** (if `franchy_message = TRUE`)  
- üì¶ Example datasets included for quick testing  

---

## üìò Description

Plant diseases account for **20‚Äì40% yield losses** in staple crops globally, with losses expected to be erratic under climate change.  

- **Crop models** simulate environmental effects on growth and yield, but rarely include dynamic disease processes.  
- **Epidemiological models** simulate disease progression, but usually in isolation, without linking to crop yield.  

**FraNchEstYN bridges this gap** by combining crop growth, disease epidemiology, and fungicide dynamics into a single framework. It allows researchers to quantify yield losses directly from epidemic dynamics.  

Specifically, FraNchEstYN:  

- üìÖ Calculates **daily infection suitability** from weather (temperature, humidity, leaf wetness)  
- ü¶† Simulates **epidemic progression** using a generic infection model  
- üå± Couples **disease severity to crop growth** by reducing light interception proportional to diseased leaf area  
- üåæ Computes **yield loss** as the difference between healthy and diseased crops  

The framework is intended for:  

- Yield loss assessment under **historical and future climate scenarios**  
- Integration with **crop model ensembles** (e.g., AgMIP datasets)  
- Multi-disease simulation **without disease-specific model coding**  
- Scenario analysis for **plant protection strategies** (fungicide timing, resistance levels, sowing dates)  

---

## üì• Installation

> ‚ö†Ô∏è **Platform notice:** FraNchEstYN currently runs **only on Windows** due to its C# simulation core. Cross-platform support is in development.

### 1. Install R

Make sure **R (version ‚â• 4.0)** is installed:  
üîó [https://cran.r-project.org/](https://cran.r-project.org/)

### 2. Install Required R Packages

If your R environment does not already have **devtools**, install it first:

```r
install.packages("devtools")
devtools::install_github("GeoModelLab/FraNchEstYN")
```

### Access Documentation    
The core function franchestyn includes Roxygen-style documentation. You can access help directly from R:

```r
?franchestyn
```
Or use the RStudio help viewer by placing your cursor inside the function and pressing F1.

The C# source code for the model core engine is included in the repository under the /src directory. A precompiled Windows .exe is also bundled under inst/extdata/Windows/.

    üì¶ The R functions handle all the configuration and execution automatically by calling this backend executable.

---

## üèÉ Getting Started

Example with built-in demo datasets

```r

library(FraNchEstYN)

res <- franchestyn(
  weather_data        = weather_example,
  management_data     = management_example,
  reference_data      = reference_example,
  cropParameters      = cropParameters$Wheat,
  diseaseParameters   = diseaseParameters$Septoria,
  fungicideParameters = fungicideParameters$protectant,
  calibration         = "disease",
  start_end           = c(1972, 1975),
  franchy_message     = TRUE,
  personality         = "farmer"
)

str(res$outputs$summary)
```
## üìä Example diagnostic output

```
==================== üìä FraNchEstYN Decision-support diagnostic üìä ====================
üßê OVERVIEW
In our fields, we‚Äôre seeing an average disease severity of about 4.3%,
while crops are yielding around 8095 kg/ha. With rainfall at 618 mm
and leaf wetness ~1125 h, conditions were moderately conducive.

üåßÔ∏è WEATHER‚ÄìDISEASE ASSOCIATIONS
Weather‚Äìdisease associations: rainfall (r=0.26); leaf-wetness (r=0.16); Tmax (r=0.13).

üçÑ DISEASE DYNAMICS (CALENDAR DATES)
Typical onset ~04/22, rapid rise ~04/29, peak ~06/08.
Growing season length ‚âà210 days.

‚öïÔ∏è FUNGICIDE PROGRAM & TIMING
Average of 4.4 sprays. 60% were preventive, 40% late.
Advice: shift first spray closer to onset (~04/22).

ü§ñ MODEL PERFORMANCE
Model‚Äìobservation performance:
‚Ä¢ DisSev: RMSE‚âà0.32, R¬≤‚âà0.84 (model underestimates)
‚Ä¢ LightInterception: insufficient validation signal

üìÖ YEARLY HIGHLIGHTS
‚Ä¢ 1980: 9.9% severity; 7718 kg/ha (10.2% loss). Peak 06/07. [highest severity]
‚Ä¢ 1986: 0% severity; 8723 kg/ha (0% loss). [lowest severity]

üí¨ PROVERB
Moisture at the wrong time invites disease to thrive.
======================================================================================
```
## üìö Documentation & Website
Full documentation and tutorials:
üëâ https://geomodellab.github.io/FraNchEstYN 

## üìÑ License
Creative Commons Attribution-NonCommercial 3.0 Unported (CC BY-NC 3.0)

## ‚úç Authors
Roberto Ferrise & Simone Bregaglio
